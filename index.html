<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
    <!-- Google Tag Manager -->
    <script>
        // Google Tag Manager
        <!-- Google Tag Manager -->
            (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T5XSRNPN');
<!-- End Google Tag Manager --> // Replace GTM-XXXXXXX with your GTM container ID
        
        // Function to track API calls with Google Tag Manager
        function trackApiCall(endpoint) {
            if (window.dataLayer) {
                // Push event data to GTM dataLayer
                window.dataLayer.push({
                    'event': 'apiCall',
                    'apiEndpoint': endpoint,
                    'apiTimestamp': new Date().toISOString()
                });
            }
        }
    </script>
    <!-- End Google Tag Manager -->
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .dashboard {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .weather-data {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        
        .weather-card {
            background: #f0f5ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            width: 100%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .temperature {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .details {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .detail-item {
            width: 30%;
            margin-bottom: 10px;
        }
        
        .timestamp {
            text-align: right;
            font-size: 0.85rem;
            color: #666;
            margin-top: 15px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }
        
        .error {
            background-color: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        h1 {
            color: #2c3e50;
        }
        
        h2 {
            color: #3498db;
            margin-top: 0;
        }
        
        .api-call-log {
            margin-top: 20px;
            height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            border: 1px solid #e9ecef;
        }
        
        .log-entry {
            border-bottom: 1px solid #e9ecef;
            padding: 5px 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T5XSRNPN"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    
    <div class="dashboard">
        <div class="header">
            <h1>Weather Dashboard</h1>
            <p>Automatically updates every 90 seconds</p>
        </div>
        
        <div id="weather-container">
            <div class="loading">Loading weather data...</div>
        </div>
        
        <h2>API Call Log</h2>
        <div id="api-call-log" class="api-call-log">
            <div class="log-entry">Waiting for first API call...</div>
        </div>
    </div>
    
    <script>
        // Configuration
        const API_KEY = "1459084b4a1da0a19fdd47351409add1"; // Get a free API key from openweathermap.org
        const CITY = "Reston"; // Default city
        const UPDATE_INTERVAL = 90 * 1000; // 90 seconds in milliseconds
        
        // Weather data cache
        let lastWeatherData = null;
        let lastUpdateTimestamp = null;
        
        // Start tracking API calls
        const apiCallLog = [];
        const maxLogEntries = 50;
        
        // Get weather data
        async function fetchWeatherData() {
            try {
                // For demo purposes, we'll use OpenWeatherMap's free API
                // In production, replace with your actual API key
                const endpoint = `https://api.openweathermap.org/data/2.5/weather?q=${CITY}&appid=${API_KEY}&units=metric`;
                
                // Log API call attempt
                const callTimestamp = new Date();
                console.log(`Fetching weather data at ${callTimestamp.toLocaleTimeString()}`);
                
                // Track API call in Google Tag Manager
                trackApiCall(endpoint);
                
                // Add to our local log
                addToApiLog(`${callTimestamp.toLocaleTimeString()}: API call to OpenWeatherMap`);
                
                // For demo purposes (when API key isn't set), we'll use mock data
                // In production, replace with real fetch call
                // if (API_KEY === "1459084b4a1da0a19fdd47351409add1") {
                //     // Mock data for demonstration
                //     return getMockWeatherData();
                // }
                
                // Real API call
                const response = await fetch(endpoint);
                if (!response.ok) {
                    throw new Error(`Weather API error: ${response.status}`);
                }
                
                const data = await response.json();
                lastWeatherData = data;
                lastUpdateTimestamp = callTimestamp;
                
                addToApiLog(`${callTimestamp.toLocaleTimeString()}: API call successful`);
                
                return data;
                
            } catch (error) {
                console.error("Error fetching weather data:", error);
                addToApiLog(`${new Date().toLocaleTimeString()}: API call failed - ${error.message}`);
                throw error;
            }
        }
        
        // Update the dashboard with weather data
        function updateWeatherDisplay(data) {
            const weatherContainer = document.getElementById('weather-container');
            
            if (!data) {
                weatherContainer.innerHTML = `
                    <div class="error">
                        <p>Unable to load weather data. Please try again later.</p>
                    </div>
                `;
                return;
            }
            
            // Format timestamp
            const timestamp = lastUpdateTimestamp 
                ? lastUpdateTimestamp.toLocaleString()
                : new Date().toLocaleString();
            
            // Format weather data
            let weatherHtml = '';
            
            if (data.name) {
                // Real data or realistic mock
                const tempC = Math.round(data.main.temp);
                const tempF = Math.round((tempC * 9/5) + 32);
                const description = data.weather[0].description;
                const humidity = data.main.humidity;
                const windSpeed = data.wind.speed;
                const pressure = data.main.pressure;
                
                weatherHtml = `
                    <div class="weather-card">
                        <h2>${data.name}</h2>
                        <div class="temperature">${tempC}째C / ${tempF}째F</div>
                        <p>${description}</p>
                        
                        <div class="details">
                            <div class="detail-item">
                                <strong>Humidity:</strong> ${humidity}%
                            </div>
                            <div class="detail-item">
                                <strong>Wind:</strong> ${windSpeed} m/s
                            </div>
                            <div class="detail-item">
                                <strong>Pressure:</strong> ${pressure} hPa
                            </div>
                        </div>
                        
                        <div class="timestamp">
                            Last updated: ${timestamp}
                        </div>
                    </div>
                `;
            } else {
                // Simple mock data
                weatherHtml = `
                    <div class="weather-card">
                        <h2>${data.location}</h2>
                        <div class="temperature">${data.temperature}째C / ${Math.round((data.temperature * 9/5) + 32)}째F</div>
                        <p>${data.condition}</p>
                        
                        <div class="details">
                            <div class="detail-item">
                                <strong>Humidity:</strong> ${data.humidity}%
                            </div>
                            <div class="detail-item">
                                <strong>Wind:</strong> ${data.windSpeed} m/s
                            </div>
                            <div class="detail-item">
                                <strong>Pressure:</strong> ${data.pressure} hPa
                            </div>
                        </div>
                        
                        <div class="timestamp">
                            Last updated: ${timestamp}
                        </div>
                    </div>
                `;
            }
            
            weatherContainer.innerHTML = weatherHtml;
        }
        
        // Add entry to API call log
        function addToApiLog(message) {
            apiCallLog.unshift(message); // Add to beginning
            
            // Trim log if needed
            if (apiCallLog.length > maxLogEntries) {
                apiCallLog.pop(); // Remove oldest entry
            }
            
            // Update log display
            const logContainer = document.getElementById('api-call-log');
            logContainer.innerHTML = apiCallLog.map(entry => `<div class="log-entry">${entry}</div>`).join('');
        }
        
        // Mock weather data for demo purposes
        function getMockWeatherData() {
            // Generate some realistic mock data with slight variations
            const now = new Date();
            const hour = now.getHours();
            
            // Temperature varies by time of day
            let baseTemp = 22; // Base temperature in Celsius
            if (hour < 6) baseTemp = 15;
            else if (hour < 12) baseTemp = 18 + (hour - 6);
            else if (hour < 18) baseTemp = 22 + (hour - 12) / 2;
            else baseTemp = 20 - (hour - 18) / 2;
            
            // Add some randomness
            const temp = baseTemp + (Math.random() * 4 - 2);
            
            // Weather conditions
            const conditions = [
                "Clear sky", "Few clouds", "Scattered clouds",
                "Partly cloudy", "Cloudy", "Light rain", "Moderate rain"
            ];
            const conditionIndex = Math.floor(Math.random() * conditions.length);
            
            return {
                location: "Reston, VA",
                temperature: Math.round(temp * 10) / 10,
                condition: conditions[conditionIndex],
                humidity: Math.round(40 + Math.random() * 40),
                windSpeed: Math.round((2 + Math.random() * 5) * 10) / 10,
                pressure: 1013 + Math.floor(Math.random() * 20) - 10
            };
        }
        
        // Initialize and schedule updates
        async function initialize() {
            try {
                // Initial data fetch
                const initialData = await fetchWeatherData();
                updateWeatherDisplay(initialData);
                
                // Schedule regular updates
                setInterval(async () => {
                    try {
                        const data = await fetchWeatherData();
                        updateWeatherDisplay(data);
                    } catch (error) {
                        console.error("Error during scheduled update:", error);
                    }
                }, UPDATE_INTERVAL);
                
            } catch (error) {
                console.error("Failed to initialize weather dashboard:", error);
                document.getElementById('weather-container').innerHTML = `
                    <div class="error">
                        <p>Unable to load weather data. Please try again later.</p>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Start the application
        initialize();
    </script>
</body>
</html>
